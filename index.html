<html lang="en">
	<head>
		<title>TreeID</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" /> 
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" href="css/jquery.mobile-1.4.1.css" />
		<script src="phonegap.js"></script>
		<script src="js/jquery-1.11.0.min.js"></script>
		<script src="js/jquery.mobile-1.4.1.min.js"></script>
		<script type="text/javascript">
			// Wait for device API libraries to load
	        //
	        document.addEventListener("deviceready", onDeviceReady, false);
	        
	        // device APIs are available
	        //
	        function onDeviceReady() {
	            playAudio('audio/ping.m4a');
	        }

	        // Audio player
	        //
	        var my_media = null;
	        var mediaTimer = null;

	        // Play audio
	        //
	        function playAudio(src) {
	            // Create Media object from src
	            my_media = new Media(src, onSuccess, onError);
				alert(src);
	            // Play audio
	            my_media.play();

	            // Update my_media position every second
	            if (mediaTimer == null) {
	                mediaTimer = setInterval(function() {
	                    // get my_media position
	                    my_media.getCurrentPosition(
	                        // success callback
	                        function(position) {
	                            if (position > -1) {
	                                setAudioPosition((position) + " sec");
	                            }
	                        },
	                        // error callback
	                        function(e) {
	                            console.log("Error getting pos=" + e);
	                            setAudioPosition("Error: " + e);
	                        }
	                    );
	                }, 1000);
	            }
	        }

	        // Pause audio
	        //
	        function pauseAudio() {
	            if (my_media) {
	                my_media.pause();
	            }
	        }

	        // Stop audio
	        //
	        function stopAudio() {
	            if (my_media) {
	                my_media.stop();
	            }
	            clearInterval(mediaTimer);
	            mediaTimer = null;
	        }

	        // onSuccess Callback
	        //
	        function onSuccess() {
	            console.log("playAudio():Audio Success");
	        }

	        // onError Callback
	        //
	        function onError(error) {
	            alert('code: '    + error.code    + '\n' +
	                  'message: ' + error.message + '\n');
	        }

	        // Set audio position
	        //
	        function setAudioPosition(position) {
	            document.getElementById('audio_position').innerHTML = position;
	        }
		</script>
	</head>
	<body>
		<div id="splash" data-role="page">
			<div data-role="header" data-theme="c">
				<h1>My PGH Parks</h1>
				<center>TreeID Audio Tour</center>
			</div>
			<div id="splashcontent" data-role="content">
				<h3>Choose a park:</h3>
				<ul data-role="listview" id="parkList">

				</ul>
			</div>

			<a href="#" class="btn large" onclick="playAudio('/audio/blackberryGentle.mp3')";>Play MP3 Audio</a>
			<a href="#" class="btn large" onclick="playAudio('/audio/blackberryGentle.ogg')";>Play OGG Audio</a>
			<a href="#" class="btn large" onclick="playAudio('/audio/blackberryGentle.m4a')";>Play M4A Audio</a>
	        <a href="#" class="btn large" onclick="pauseAudio();">Pause Playing Audio</a>
	        <a href="#" class="btn large" onclick="stopAudio();">Stop Playing Audio</a>
	        <p id="audio_position"></p>

		</div><!-- splash -->
		

		
		<script type="text/javascript">
			$.getJSON("./data/parks.json", function(parks){
			   	//alert("parks:"+parks[0].id);
				//Start off with an empty list every time to get the latest from server
				$("#parkList").empty();

				//add the park items as list
				$.each(parks, function(i, park){
					//alert("park:"+park.name);
					var parkName = park.name;
					var lowerCaseTrimParkName = parkName.toLowerCase().replace(/\s/g, '');
					var linkToAppend = "<li><a href=\"#"
						+ lowerCaseTrimParkName
						+ "\" data-transition=\"slide\">"
						+ parkName
						+ " Park</a></li>";
					//alert("linkToAppend:" + linkToAppend);
					$("#parkList").append(linkToAppend);
				});

			    //refresh the list view to show the latest changes
			    $("#parkList").listview("refresh");
			    
			    //creates a park link list item
				/*
				function generateParkLink(park){
					alert("parkname:"+park.name);
					return 
						  "<li><a href=\"#"
						+ park.name
						+ "\" data-transition=\"slide\">"
						+ park.name
						+ "</a></li>";
					//debugger;
					return "<li><a href=\"#\""
					    + "onclick=\"goToParkPage(\""
					    + park.name
					    + "\")>"
					    + park.name
					    + "</a></li>";
					    
				}
				*/

				function goToParkPage(parkName){

					//create the page html template
					var parkPage = 
						$("<div data-role='page' data-url=dummyUrl><div data-role='header'><h1>"
			              + parkName + "</h1></div><div data-role='content'><img border='0' src='" 
			              + parkName + "' width=204 height=288></img></div><div data-role='footer'><h4>" 
			              + parkName + "</h4></div></div>");

					//append the new page to the page container
					parkPage.appendTo( $.mobile.pageContainer );

					//go to the newly created page
					$.mobile.changePage( parkPage );
				}

		    });
		</script>
	</body>
</html>